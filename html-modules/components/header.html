<!-- 
  Digital Twin IDE Header Component
  Provides top navigation, language selector and toolbar functionality
-->

<template>
  <header class="header-container">
    <!-- Language Selector -->
    <div id="language-switcher" class="language-switcher">
      <select id="language-select" aria-label="Select language">
        <option value="en">ðŸ‡ºðŸ‡¸ English</option>
        <option value="pl">ðŸ‡µðŸ‡± Polski</option>
        <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
        <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
        <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
        <option value="it">ðŸ‡®ðŸ‡¹ Italiano</option>
      </select>
    </div>
    
    <!-- Top Menu -->
    <nav class="top-menu">
      <ul>
        <li><a href="#" class="menu-item" data-action="file-menu" data-i18n="ui.menu.file">File</a></li>
        <li><a href="#" class="menu-item" id="simulation-menu" data-action="tools-menu" data-i18n="ui.menu.tools">Tools</a></li>
        <li><a href="#" class="menu-item" data-action="view-menu" data-i18n="ui.menu.view">View</a></li>
        <li><a href="#" class="menu-item" data-action="help-menu" data-i18n="ui.menu.help">Help</a></li>
      </ul>
    </nav>

    <!-- Toolbar -->
    <div class="toolbar">
      <button id="export-btn" class="btn btn-success" data-action="export-project" data-i18n="ui.buttons.export">Export (.dtwin)</button>
      <button id="import-btn" class="btn btn-primary" data-action="import-project" data-i18n="ui.buttons.import">Import (.dtwin)</button>
      <button id="export-png-btn" class="btn btn-warning" data-action="export-png" data-i18n="ui.buttons.exportPng">Export PNG</button>
      <button id="export-svg-btn" class="btn btn-primary" data-action="export-svg" data-i18n="ui.buttons.exportSvg">Export SVG</button>
      <button id="connection-mode-btn" class="btn btn-purple" data-action="toggle-connection-mode" data-i18n="ui.buttons.connect">Connect Components</button>
    </div>
  </header>
</template>

<style>
  /* Header styling */
  .header-container {
    display: flex;
    align-items: center;
    padding: 0.5rem 1rem;
    background-color: #2c3e50;
    color: #ecf0f1;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  /* Language selector */
  .language-switcher {
    margin-right: 1rem;
  }

  .language-switcher select {
    padding: 0.3rem;
    background-color: #34495e;
    color: #ecf0f1;
    border: 1px solid #7f8c8d;
    border-radius: 4px;
  }

  /* Top menu */
  .top-menu {
    flex: 1;
  }

  .top-menu ul {
    display: flex;
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .top-menu li {
    margin-right: 1rem;
  }

  .top-menu a {
    color: #ecf0f1;
    text-decoration: none;
    padding: 0.3rem 0.5rem;
    border-radius: 3px;
    transition: background-color 0.2s;
  }

  .top-menu a:hover {
    background-color: #34495e;
  }

  /* Toolbar */
  .toolbar {
    display: flex;
    gap: 0.5rem;
  }

  .btn {
    padding: 0.4rem 0.8rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: opacity 0.2s;
  }

  .btn:hover {
    opacity: 0.9;
  }

  .btn-success {
    background-color: #27ae60;
    color: white;
  }

  .btn-primary {
    background-color: #3498db;
    color: white;
  }

  .btn-warning {
    background-color: #f39c12;
    color: white;
  }

  .btn-purple {
    background-color: #8e44ad;
    color: white;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .header-container {
      flex-direction: column;
      padding: 0.5rem;
    }

    .language-switcher, .top-menu, .toolbar {
      margin: 0.3rem 0;
      width: 100%;
    }

    .toolbar {
      flex-wrap: wrap;
      justify-content: center;
    }

    .top-menu ul {
      justify-content: center;
    }
  }
</style>

<script>
  /**
   * Header Component for Digital Twin IDE
   * Handles top menu actions, language selection and toolbar buttons
   */
  class HeaderComponent extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
    }

    connectedCallback() {
      // Clone the template content
      const template = this.ownerDocument.querySelector('template');
      this.shadowRoot.appendChild(template.content.cloneNode(true));
      
      // Initialize component
      this._initEventListeners();
      this._initLanguageSelector();
      
      // Dispatch ready event
      this.dispatchEvent(new CustomEvent('header-ready', { 
        bubbles: true, 
        composed: true 
      }));
    }

    /**
     * Initialize event listeners for buttons and menu items
     * @private
     */
    _initEventListeners() {
      // Menu item clicks
      this.shadowRoot.querySelectorAll('[data-action]').forEach(el => {
        el.addEventListener('click', (e) => {
          e.preventDefault();
          const action = el.dataset.action;
          this._handleAction(action, el);
        });
      });

      // Connection mode toggle
      const connectionBtn = this.shadowRoot.querySelector('#connection-mode-btn');
      if (connectionBtn) {
        connectionBtn.addEventListener('click', () => {
          connectionBtn.classList.toggle('active');
          this._dispatchEvent('toggle-connection-mode', { 
            active: connectionBtn.classList.contains('active') 
          });
        });
      }
    }

    /**
     * Initialize language selector
     * @private
     */
    _initLanguageSelector() {
      const langSelect = this.shadowRoot.querySelector('#language-select');
      if (langSelect) {
        // Set current language
        const currentLang = localStorage.getItem('app-language') || 'en';
        langSelect.value = currentLang;
        
        // Handle language changes
        langSelect.addEventListener('change', () => {
          const newLang = langSelect.value;
          this._dispatchEvent('language-change', { language: newLang });
          localStorage.setItem('app-language', newLang);
        });
      }
    }

    /**
     * Handle action based on data-action attribute
     * @private
     */
    _handleAction(action, element) {
      // Dispatch appropriate event based on the action
      this._dispatchEvent(action, { source: element });
      
      console.log(`Header action: ${action}`);
    }

    /**
     * Helper to dispatch custom events
     * @private
     */
    _dispatchEvent(name, detail = {}) {
      this.dispatchEvent(new CustomEvent(name, {
        bubbles: true,
        composed: true,
        detail
      }));
    }
  }

  // Define the custom element
  if (!customElements.get('app-header')) {
    customElements.define('app-header', HeaderComponent);
  }
</script>
